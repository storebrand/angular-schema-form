angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,i){var a=function(t,a,n){if("string"===a.type&&"date-format"===a.format){var m=e.stdFormObj(t,a,n);return m.key=n.path,m.type="datepicker",n.lookup[i.stringify(n.path)]=m,m}};e.defaults.string.unshift(a)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";var t="YYYY-MM-DDTHH:mm:ss",i="YYYY-MM-DD",a="HH:mm",n="HH:mm:ss";return{restrict:"A",require:"ngModel",priority:0,link:function(m,o,r,u){function f(){e(function(){m.selectedTime=V(),M(u.$viewValue),T(u.$viewValue)})}function l(e){return function(i){var a={};a[e]=i,w(a);var n=u.$viewValue;if(!q&&H.isValid()&&H.format(t)>u.$viewValue)n=H.format(t);else{if(!(!q&&F.isValid()&&F.format(t)<u.$viewValue))return;n=F.format(t)}j&&M(n),T(n)}}function d(){return s(x.val(),m.selectedTime)}function s(e,t){return moment(e,"DD.MM.YY").format(i)+(j?"T"+moment(t,a).format(n):"")}function c(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function v(e){if(!e)return null;var t=30,i=e.minute()%t;return e.subtract("minutes",i).format(a)}function D(e,t){return e&&t&&moment(e).isValid()&&moment(e).isValid()&&moment(e).format(i)===moment(t).format(i)}function V(){return u.$viewValue?moment(u.$viewValue).format(a):r.defaultTime}function p(e){var t=D(F,e),i=D(H,e);return t&&O<r.defaultTime?O:i&&C>r.defaultTime?C:r.defaultTime}function h(){for(var e=[":00",":30"],t=0;Y>t;t++)for(var i in e)m.timeOptions.push({value:c(t+e[i]),isDisabled:!1});o.addClass("has-timepicker")}function w(e){e.min&&moment(e.min).isValid()&&(H=moment(e.min),C=moment(H,t).format(a),$(o).data("DateTimePicker").setMinDate(H)),e.max&&moment(e.max).isValid()&&(F=moment(e.max),O=F.format(a),$(o).data("DateTimePicker").setMaxDate(F))}function T(e){var i=moment(e,t);if(i.isValid()){var a=i.format("DD.MM.YY");$(o).data("DateTimePicker").setDate(a)}}function k(e,t){m.timeOptions.forEach(function(i){i.isDisabled=e&&i.value>e||t&&i.value<t})}function M(e){var i=moment(e,t);if(j){var a=D(F,i)&&O,n=D(H,i)&&C,o=!a||m.selectedTime<=a,r=!n||m.selectedTime>=n;o&&r?k(a,n):u.$setViewValue(s(x.val(),n||a||p(i)))}}if(o.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var Y=24,g=moment(),y=moment().add(1,"day"),b={today:g,tomorrow:y},x=$(o).find("input"),P=m.$eval(r.monthlyDifference),H=b[r.minDate]||moment(r.minDate)||m.$eval(r.disableUntilToday)&&g.toDate(),F=b[r.maxDate]||moment(r.maxDate)||P&&moment(g).add(P,"Month").toDate(),C=v(H),O=v(F),j=Boolean(r.showTime),q=!!r.noDefaultDate;m.timeOptions=[],$(o).datetimepicker({pickTime:!1,language:"nb",format:"DD.MM.YY",useCurrent:!1,minDate:H,maxDate:F}).on("dp.change",function(){e(function(){u.$setViewValue(d())})}).on("dp.error",function(){e(function(){u.$setViewValue(void 0)})}),m.$watch(m.keyModelName,f),H.isValid()||m.$watch(r.minDate,l("min")),F.isValid()||m.$watch(r.maxDate,l("max")),j?(h(),m.selectedTimeChanged=function(){u.$modelValue&&u.$setViewValue(d())}):o.addClass("no-timepicker")}}}}]);