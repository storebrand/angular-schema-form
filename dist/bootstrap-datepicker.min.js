angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,a){var n=function(t,n,i){if("string"===n.type&&"date-format"===n.format){var o=e.stdFormObj(t,n,i);return o.key=i.path,o.type="datepicker",i.lookup[a.stringify(i.path)]=o,o}};e.defaults.string.unshift(n)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";return{restrict:"A",require:"ngModel",priority:0,link:function(t,a,n,i){function o(){return r(V.val(),t.selectedTime)}function r(e,t){return moment(e,"DD.MM.YY").format("YYYY-MM-DD")+(b?"T"+moment(t,"HH:mm").format("HH:mm:ss"):"")}function m(e){return moment(e).format("DD.MM.YY")}function u(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function f(e){if(!e)return null;var t=30,a=e.minute()%t;return e.subtract("minutes",a).format("HH:mm")}function d(){return i.$viewValue?moment(i.$viewValue).format("HH:mm"):c(Y)}function c(e){var t=e&&g&&0===g.diff(e,"days"),a=e&&M&&0===M.diff(e,"days");return n.defaultTime||(t&&v>w?w:a&&T>v?T:v)}function s(){for(var e=0;D>e;e++)[":00",":30"].forEach(function(a){t.timeOptions.push({value:u(e+a),isDisabled:!1})})}function l(e,a){var n=t.selectedTime;n&&t.timeOptions.forEach(function(t){t.isDisabled=e&&t.value>e||a&&t.value<a});var o=!e||e>=n,r=!a||n>=a;t.selectedTime=o&&r?d():c(i.$viewValue)}if(a.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var D=24,v="12:00",p=moment(),h=moment().add(1,"day"),y={today:p,tomorrow:h},V=$(a).find("input"),k=t.$eval(n.monthlyDifference),M=y[n.minDate]||moment(n.minDate)||t.$eval(n.disableUntilToday)&&p.toDate(),g=y[n.maxDate]||moment(n.maxDate)||k&&moment(p).add(k,"Month").toDate(),T=f(M),w=f(g),b=Boolean(n.showTime),Y=n.defaultDate;t.timeOptions=[],$(a).datetimepicker({pickTime:!1,language:"nb",format:"DD.MM.YY",useCurrent:!1,minDate:M,maxDate:g}).on("dp.change",function(){t.$apply(function(){i.$setViewValue(o())})}).on("dp.error",function(){t.$apply(function(){i.$setViewValue(void 0)})});var H,P;t.$watch(t.keyModelName,function(){e(function(){M.isValid()||(H=t.$eval(n.minDate),H&&moment(H).isValid()&&(M=moment(H),M>Y&&(Y=M),$(a).data("DateTimePicker").setMinDate(M))),g.isValid()||(P=t.$eval(n.maxDate),P&&moment(P).isValid()&&(g=moment(P),Y>g&&(Y=g),$(a).data("DateTimePicker").setMaxDate(g)));var e=i.$viewValue,o=0===g.diff(e,"days"),r=0===M.diff(e,"days");if(b&&l(o&&w,r&&T),e){var u=m(e);$(a).data("DateTimePicker").setDate(u)}})}),b&&(s(),t.selectedTimeChanged=function(){i.$setViewValue(o())})}}}}]);