angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,a){var i=function(t,i,n){if("string"===i.type&&"date-format"===i.format){var m=e.stdFormObj(t,i,n);return m.key=n.path,m.type="datepicker",n.lookup[a.stringify(n.path)]=m,m}};e.defaults.string.unshift(i)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";return{restrict:"A",require:"ngModel",priority:0,link:function(t,a,i,n){function m(){var e=y.val();return o(e,t.selectedTime)}function o(e,t){return moment(e,"DD.MM.YY").format("YYYY-MM-DD")+(g?"T"+moment(t,"HH:mm").format("HH:mm:ss"):"")}function r(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function f(e){if(!e)return null;var t=30,a=e.minute()%t;return e.subtract("minutes",a).format("HH:mm")}function u(){return n.$viewValue?moment(n.$viewValue).format("HH:mm"):b}function d(){return moment(n.$viewValue||w).format("DD.MM.YY")}function c(){for(var e=0;l>e;e++)[":00",":30"].forEach(function(a){t.timeOptions.push({value:r(e+a),isDisabled:!1})})}function s(e,a){t.timeOptions.forEach(function(t){t.isDisabled=e&&t.value>e||a&&t.value<a})}if(a.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var l=24,D="12:00",v=moment(),p=moment().add(1,"day"),M={today:v,tomorrow:p},y=$(a).find("input"),h=t.$eval(i.monthlyDifference),Y=M[i.minDate]||moment(i.minDate)||t.$eval(i.disableUntilToday)&&v.toDate(),V=M[i.maxDate]||moment(i.maxDate)||h&&moment(v).add(h,"Month").toDate(),T=f(Y),k=f(V),g=Boolean(i.showTime),w=i.defaultDate||v,b=i.defaultTime||(V&&0===V.diff(moment(w))&&D>k?k:Y&&0===Y.diff(moment(w))&&T>D?T:D);t.timeOptions=[],$(a).datetimepicker({pickTime:!1,language:"nn",format:"DD.MM.YY",minDate:Y,maxDate:V}).on("dp.change",function(){t.$apply(function(){var e=m();if(g&&V){var a=0===V.diff(e,"days"),i=0===Y.diff(e,"days");(a&&t.selectedTime>k||i&&t.selectedTime<T)&&(t.selectedTime=b,e=m())}n.$setViewValue(e)})}).on("dp.error",function(){t.$apply(function(){n.$setViewValue(void 0)})});var H;t.$watch(t.keyModelName,function(){e(function(){H=t.$eval(i.minDate),!Y.isValid()&&H&&moment(H).isValid()&&(Y=moment(H),Y>w&&(w=Y),$(a).data("DateTimePicker").setMinDate(Y)),H=t.$eval(i.maxDate),!V.isValid()&&H&&moment(H).isValid()&&(V=moment(H),w>V&&(w=V),$(a).data("DateTimePicker").setMaxDate(V));var e=0===V.diff(n.$viewValue,"days"),m=0===Y.diff(n.$viewValue,"days");s(g&&e&&k,g&&m&&T),t.selectedTime=u();var o=d();moment(o,"DD.MM.YY").diff(V,"days")>0&&(o=V.format("DD.MM.YY")),moment(o,"DD.MM.YY").diff(Y,"days")<0&&(o=Y.format("DD.MM.YY")),$(a).data("DateTimePicker").setDate(o)})}),g&&(c(),t.selectedTimeChanged=function(){n.$setViewValue(m())})}}}}]);