angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,a,t){var i=function(a,i,n){if("string"===i.type&&"date-format"===i.format){var m=e.stdFormObj(a,i,n);return m.key=n.path,m.type="datepicker",n.lookup[t.stringify(n.path)]=m,m}};e.defaults.string.unshift(i)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout","$rootScope",function(e,a){"use strict";return{restrict:"A",require:"ngModel",priority:0,link:function(t,i,n,m){function o(){e(function(){var e={min:g.isValid()?null:t.$eval(n.minDate),max:w.isValid()?null:t.$eval(n.maxDate)};v(e)})}function r(){return u(M.val(),t.selectedTime)}function u(e,a){return moment(e,"DD.MM.YY").format("YYYY-MM-DD")+(x?"T"+moment(a,"HH:mm").format("HH:mm:ss"):"")}function d(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function f(e){if(!e)return null;var a=30,t=e.minute()%a;return e.subtract("minutes",t).format("HH:mm")}function c(){return m.$viewValue?moment(m.$viewValue).format("HH:mm"):l(P)}function l(e){var a=e&&w&&0===w.diff(e,"days"),t=e&&g&&0===g.diff(e,"days");return n.defaultTime||(a&&y>b?b:t&&T>y?T:y)}function s(){for(var e=0;h>e;e++)[":00",":30"].forEach(function(a){t.timeOptions.push({value:d(e+a),isDisabled:!1})});i.addClass("has-timepicker")}function v(e){e.min&&moment(e.min).isValid()&&(g=moment(e.min),T=moment(g,"YYYY-MM-DDTHH:mm:ss").format("HH:mm"),g>P&&(P=g),$(i).data("DateTimePicker").setMinDate(g)),e.max&&moment(e.max).isValid()&&(w=moment(e.max),b=w.format("HH:mm"),P>w&&(P=w),$(i).data("DateTimePicker").setMaxDate(w))}function D(e,a){var i=t.selectedTime;i&&t.timeOptions.forEach(function(t){t.isDisabled=e&&t.value>e||a&&t.value<a});var n=!e||e>=i,o=!a||i>=a;t.selectedTime=n&&o?c():l(m.$viewValue)}function p(){e(function(){var e=moment(m.$viewValue,"YYYY-MM-DDTHH:mm:ss"),t=0===w.diff(e,"days"),n=0===g.diff(e,"days");if(x&&D(t&&b,n&&T),e.isValid()){var o=e.format("DD.MM.YY");$(i).data("DateTimePicker").setDate(o),a.$broadcast("datetimepicker.changed",{name:F,value:e})}})}if(i.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var h=24,y="12:00",V=moment(),Y=moment().add(1,"day"),k={today:V,tomorrow:Y},M=$(i).find("input"),H=t.$eval(n.monthlyDifference),g=k[n.minDate]||moment(n.minDate)||t.$eval(n.disableUntilToday)&&V.toDate(),w=k[n.maxDate]||moment(n.maxDate)||H&&moment(V).add(H,"Month").toDate(),T=f(g),b=f(w),x=Boolean(n.showTime),P=n.defaultDate,F=t.$eval(n.name).pop();t.timeOptions=[],$(i).datetimepicker({pickTime:!1,language:"nb",format:"DD.MM.YY",useCurrent:!1,minDate:g,maxDate:w}).on("dp.change",function(){t.$apply(function(){m.$setViewValue(r())})}).on("dp.error",function(){t.$apply(function(){m.$setViewValue(void 0)})}),t.$watch("model",o),t.$watch(t.keyModelName,p),t.$on("datetimepicker.changed",function(e,a){var t={min:a.name===n.minDate&&a.value,max:a.name===n.maxDate&&a.value};v(t);var i=0===w.diff(m.$viewValue,"days"),o=0===g.diff(m.$viewValue,"days");x&&D(i&&b,o&&T)}),x?(s(),t.selectedTimeChanged=function(){m.$modelValue&&m.$setViewValue(r())}):i.addClass("no-timepicker")}}}}]);