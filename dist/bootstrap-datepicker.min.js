angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,n){var a=function(t,a,o){if("string"===a.type&&"date-format"===a.format){var i=e.stdFormObj(t,a,o);return i.key=o.path,i.type="datepicker",o.lookup[n.stringify(o.path)]=i,i}};e.defaults.string.unshift(a)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";return{restrict:"A",require:"ngModel",priority:1,link:function(t,n,a,o){function i(){var e=g.val(),t=h.val();return console.log("-getModelDateTime-"),console.log(e,t),r(e,t)}function r(e,t){return moment(e,"DD.MM.YY").format("YYYY-MM-DD")+(V?"T"+moment(t,"HH:mm").format("HH:mm:ss"):"")}function m(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function u(e){if(!e)return null;var t=30,n=e.minute()%t;return e.subtract("minutes",n).add("minutes",n>t/2?t:0).format("HH:mm")}function l(){return moment(o.$viewValue).format("HH:mm")}function c(){return moment(o.$viewValue).format("DD.MM.YY")}function f(e,t){var n,a;if(t)h.find("option").each(function(t,o){var i=$(o);n=i.text(),a=e&&n>e,$(o).attr("disabled",a)});else for(var o=0;d>o;o++)[":00",":30"].forEach(function(t){n=m(o+t),a=e&&n>e,h.append("<option "+(a?"disabled":"")+">"+n+"</option>")})}if(n.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var d=24,s="12:00",p=moment(),v=moment().add(1,"day"),D={today:p,tomorrow:v},g=$(n).find("input"),h=$(n).find("select"),y=t.$eval(a.monthlyDifference),w=D[a.minDate]||moment(a.minDate)||t.$eval(a.disableUntilToday)&&p.toDate(),M=D[a.maxDate]||moment(a.maxDate)||y&&moment(p).add(y,"Month").toDate(),k=u(M),V=Boolean(a.showTime),Y=a.defaultDate||p,b=a.defaultTime||(M&&0===M.diff(moment(Y))&&s>k?k:s);$(n).datetimepicker({pickTime:!1,language:"nn",format:"DD.MM.YY",minDate:w,maxDate:M}).on("dp.change",function(){t.$apply(function(){var e=i();if(console.log("modelDateTime",e),V&&M){var t=0===M.diff(e,"days");console.log("isMaxDateSelected",t),t&&h.val()>k&&(h.val(b),e=i()),f(t&&k,!0)}o.$setViewValue(e)})}).on("dp.error",function(){t.$apply(function(){o.$setViewValue(void 0)})}),t.$watch(t.keyModelName,function(){e(function(){console.log("$watch",l(),b,o.$viewValue?l():b),h.val(o.$viewValue?l():b),$(n).data("DateTimePicker").setDate(o.$viewValue?c():Y)})}),V&&(f(k),h.change(function(){t.$apply(function(){o.$setViewValue(i())})}))}}}}]);