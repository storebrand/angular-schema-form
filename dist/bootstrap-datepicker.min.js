angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,i){var a=function(t,a,n){if("string"===a.type&&"date-format"===a.format){var m=e.stdFormObj(t,a,n);return m.key=n.path,m.type="datepicker",n.lookup[i.stringify(n.path)]=m,m}};e.defaults.string.unshift(a)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";var t="YYYY-MM-DDTHH:mm:ss",i="YYYY-MM-DD",a="HH:mm",n="HH:mm:ss";return{restrict:"A",require:"ngModel",priority:0,link:function(m,o,r,u){function f(e){return function(i){var a={};if(a[e]=i,w(a),m.selectedTime){var n=F.isValid()&&F.format(t)>u.$viewValue?F.format(t):C.isValid()&&C.format(t)<u.$viewValue?C.format(t):u.$viewValue;T(n),k(n)}}}function c(){e(function(){m.selectedTime=V(),T(u.$viewValue),k(u.$viewValue)})}function s(){return d(P.val(),m.selectedTime)}function d(e,t){return moment(e,"DD.MM.YY").format(i)+(j?"T"+moment(t,a).format(n):"")}function l(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function v(e){if(!e)return null;var t=30,i=e.minute()%t;return e.subtract("minutes",i).format(a)}function D(e,t){return e&&t&&moment(e).isValid()&&moment(e).isValid()&&moment(e).format(i)===moment(t).format(i)}function V(){return u.$viewValue?moment(u.$viewValue).format(a):p(q)}function p(e){var t=D(C,e),i=D(F,e);return t&&g>E?E:i&&O>g?O:r.defaultTime||g}function h(){for(var e=0;Y>e;e++)[":00",":30"].forEach(function(t){m.timeOptions.push({value:l(e+t),isDisabled:!1})});o.addClass("has-timepicker")}function w(e){e.min&&moment(e.min).isValid()&&(F=moment(e.min),O=moment(F,t).format(a),F>q&&(q=F),$(o).data("DateTimePicker").setMinDate(F)),e.max&&moment(e.max).isValid()&&(C=moment(e.max),E=C.format(a),q>C&&(q=C),$(o).data("DateTimePicker").setMaxDate(C))}function k(e){var i=moment(e,t);if(i.isValid()){var a=i.format("DD.MM.YY");$(o).data("DateTimePicker").setDate(a)}}function M(e,t){m.timeOptions.forEach(function(i){i.isDisabled=e&&i.value>e||t&&i.value<t})}function T(e){var i=moment(e,t);if(j){var a=D(C,i)&&E,n=D(F,i)&&O,o=!a||m.selectedTime<=a,r=!n||m.selectedTime>=n;o&&r?M(a,n):u.$setViewValue(d(P.val(),n||a||p(i)))}}if(o.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var Y=24,g="12:00",y=moment(),b=moment().add(1,"day"),x={today:y,tomorrow:b},P=$(o).find("input"),H=m.$eval(r.monthlyDifference),F=x[r.minDate]||moment(r.minDate)||m.$eval(r.disableUntilToday)&&y.toDate(),C=x[r.maxDate]||moment(r.maxDate)||H&&moment(y).add(H,"Month").toDate(),O=v(F),E=v(C),j=Boolean(r.showTime),q=r.defaultDate;m.timeOptions=[],$(o).datetimepicker({pickTime:!1,language:"nb",format:"DD.MM.YY",useCurrent:!1,minDate:F,maxDate:C}).on("dp.change",function(){e(function(){u.$setViewValue(s())})}).on("dp.error",function(){e(function(){u.$setViewValue(void 0)})}),m.$watch(m.keyModelName,c),F.isValid()||m.$watch(r.minDate,f("min")),C.isValid()||m.$watch(r.maxDate,f("max")),j?(h(),m.selectedTimeChanged=function(){u.$modelValue&&u.$setViewValue(s())}):o.addClass("no-timepicker")}}}}]);