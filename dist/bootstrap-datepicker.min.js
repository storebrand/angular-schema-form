angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,a){var n=function(t,n,i){if("string"===n.type&&"date-format"===n.format){var m=e.stdFormObj(t,n,i);return m.key=i.path,m.type="datepicker",i.lookup[a.stringify(i.path)]=m,m}};e.defaults.string.unshift(n)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout","$rootScope",function(e,t){"use strict";var a="YYYY-MM-DDTHH:mm:ss",n="YYYY-MM-DD",i="HH:mm",m="HH:mm:ss";return{restrict:"A",require:"ngModel",priority:0,link:function(o,r,u,c){function l(){e(function(){var e={min:H.isValid()?null:o.$eval(u.minDate),max:F.isValid()?null:o.$eval(u.maxDate)};k(e)})}function d(){return f(x.val(),o.selectedTime)}function f(e,t){return moment(e,"DD.MM.YY").format(n)+(E?"T"+moment(t,i).format(m):"")}function s(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function v(e){if(!e)return null;var t=30,a=e.minute()%t;return e.subtract("minutes",a).format(i)}function D(e,t){return e&&t&&moment(e).format(n)===moment(t).format(n)}function p(){return c.$viewValue?moment(c.$viewValue).format(i):h(j)}function h(e){var t=D(F,e),a=D(H,e);return u.defaultTime||(t&&Y>O?O:a&&C>Y?C:Y)}function V(){for(var e=0;w>e;e++)[":00",":30"].forEach(function(t){o.timeOptions.push({value:s(e+t),isDisabled:!1})});r.addClass("has-timepicker")}function k(e){e.min&&moment(e.min).isValid()&&(H=moment(e.min),C=moment(H,a).format(i),H>j&&(j=H),$(r).data("DateTimePicker").setMinDate(H)),e.max&&moment(e.max).isValid()&&(F=moment(e.max),O=F.format(i),j>F&&(j=F),$(r).data("DateTimePicker").setMaxDate(F))}function M(e,t){var a=o.selectedTime;a&&o.timeOptions.forEach(function(a){a.isDisabled=e&&a.value>e||t&&a.value<t});var n=!e||e>=a,i=!t||a>=t;o.selectedTime=n&&i?p():h(c.$viewValue)}function g(){e(function(){var e=moment(c.$viewValue,a),n=D(F,e),i=D(H,e);if(E&&M(n&&O,i&&C),e.isValid()){var m=e.format("DD.MM.YY");$(r).data("DateTimePicker").setDate(m),t.$broadcast("datetimepicker.changed",{name:q,value:e})}})}if(r.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var w=24,Y="12:00",y=moment(),T=moment().add(1,"day"),b={today:y,tomorrow:T},x=$(r).find("input"),P=o.$eval(u.monthlyDifference),H=b[u.minDate]||moment(u.minDate)||o.$eval(u.disableUntilToday)&&y.toDate(),F=b[u.maxDate]||moment(u.maxDate)||P&&moment(y).add(P,"Month").toDate(),C=v(H),O=v(F),E=Boolean(u.showTime),j=u.defaultDate,q=_.last(o.$eval(u.name));o.timeOptions=[],$(r).datetimepicker({pickTime:!1,language:"nb",format:"DD.MM.YY",useCurrent:!1,minDate:H,maxDate:F}).on("dp.change",function(){o.$apply(function(){c.$setViewValue(d())})}).on("dp.error",function(){o.$apply(function(){c.$setViewValue(void 0)})}),o.$watch("model",l),o.$watch(o.keyModelName,g),o.$on("datetimepicker.changed",function(e,t){if(t.name!==q){var a={min:t.name===u.minDate&&t.value,max:t.name===u.maxDate&&t.value};k(a);var n=D(F,c.$viewValue),i=D(H,c.$viewValue);E&&M(n&&O,i&&C)}}),E?(V(),o.selectedTimeChanged=function(){c.$modelValue&&c.$setViewValue(d())}):r.addClass("no-timepicker")}}}}]);