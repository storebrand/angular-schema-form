angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,n){var i=function(t,i,a){if("string"===i.type&&"date-format"===i.format){var o=e.stdFormObj(t,i,a);return o.key=a.path,o.type="datepicker",a.lookup[n.stringify(a.path)]=o,o}};e.defaults.string.unshift(i)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";return{restrict:"A",require:"ngModel",priority:0,link:function(t,n,i,a){function o(){var e=y.val();return r(e,t.selectedTime)}function r(e,t){return moment(e,"DD.MM.YY").format("YYYY-MM-DD")+(T?"T"+moment(t,"HH:mm").format("HH:mm:ss"):"")}function m(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function u(e){if(!e)return null;var t=30,n=e.minute()%t;return e.subtract("minutes",n).format("HH:mm")}function f(){return a.$viewValue?moment(a.$viewValue).format("HH:mm"):Y}function c(){return moment(a.$viewValue||V).format("DD.MM.YY")}function d(){for(var e=0;s>e;e++)[":00",":30"].forEach(function(n){t.timeOptions.push({value:m(e+n),isDisabled:!1})})}function l(e){t.timeOptions.forEach(function(t){t.isDisabled=e&&t.value>e})}if(n.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var s=24,p="12:00",v=moment(),D=moment().add(1,"day"),h={today:v,tomorrow:D},y=$(n).find("input"),g=($(n).find("select"),t.$eval(i.monthlyDifference)),w=h[i.minDate]||moment(i.minDate)||t.$eval(i.disableUntilToday)&&v.toDate(),M=h[i.maxDate]||moment(i.maxDate)||g&&moment(v).add(g,"Month").toDate(),k=u(M),T=Boolean(i.showTime),V=i.defaultDate||v,Y=i.defaultTime||(M&&0===M.diff(moment(V))&&p>k?k:p);t.timeOptions=[],$(n).datetimepicker({pickTime:!1,language:"nn",format:"DD.MM.YY",minDate:w,maxDate:M}).on("dp.change",function(){t.$apply(function(){var e=o();if(T&&M){var n=0===M.diff(e,"days");n&&t.selectedTime>k&&(t.selectedTime=Y,e=o())}a.$setViewValue(e)})}).on("dp.error",function(){t.$apply(function(){a.$setViewValue(void 0)})}),t.$watch(t.keyModelName,function(){e(function(){var e=0===M.diff(a.$viewValue,"days");l(T&&e&&k),t.selectedTime=f(),t.selectedDate=c()})}),T&&(d(),t.selectedTimeChanged=function(){a.$setViewValue(o())})}}}}]);