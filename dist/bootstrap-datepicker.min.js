angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,i){var a=function(t,a,n){if("string"===a.type&&"date-format"===a.format){var m=e.stdFormObj(t,a,n);return m.key=n.path,m.type="datepicker",n.lookup[i.stringify(n.path)]=m,m}};e.defaults.string.unshift(a)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";return{restrict:"A",require:"ngModel",priority:0,link:function(t,i,a,n){function m(){var e=y.val();return o(e,t.selectedTime)}function o(e,t){return moment(e,"DD.MM.YY").format("YYYY-MM-DD")+(g?"T"+moment(t,"HH:mm").format("HH:mm:ss"):"")}function r(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function u(e){if(!e)return null;var t=30,i=e.minute()%t;return e.subtract("minutes",i).format("HH:mm")}function f(){return n.$viewValue?moment(n.$viewValue).format("HH:mm"):b}function d(){return n.$viewValue&&moment(n.$viewValue).format("DD.MM.YY")}function c(){for(var e=0;l>e;e++)[":00",":30"].forEach(function(i){t.timeOptions.push({value:r(e+i),isDisabled:!1})})}function s(e,i){t.timeOptions.forEach(function(t){t.isDisabled=e&&t.value>e||i&&t.value<i})}if(i.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var l=24,v="12:00",D=moment(),p=moment().add(1,"day"),h={today:D,tomorrow:p},y=$(i).find("input"),V=t.$eval(a.monthlyDifference),w=h[a.minDate]||moment(a.minDate)||t.$eval(a.disableUntilToday)&&D.toDate(),T=h[a.maxDate]||moment(a.maxDate)||V&&moment(D).add(V,"Month").toDate(),k=u(w),M=u(T),g=Boolean(a.showTime),Y=a.defaultDate,b=a.defaultTime||(T&&0===T.diff(moment(Y))&&v>M?M:w&&0===w.diff(moment(Y))&&k>v?k:v);t.timeOptions=[];{a.events||{}}$(i).datetimepicker({pickTime:!1,language:"nn",format:"DD.MM.YY",useCurrent:!1,minDate:w,maxDate:T}).on("dp.change",function(){t.$apply(function(){var e=m();if(g&&T){var i=0===T.diff(e,"days"),a=0===w.diff(e,"days");(i&&t.selectedTime>M||a&&t.selectedTime<k)&&(t.selectedTime=b,e=m())}n.$setViewValue(e)})}).on("dp.error",function(){t.$apply(function(){n.$setViewValue(void 0)})});var H;t.$watch(t.keyModelName,function(){e(function(){H=t.$eval(a.minDate),!w.isValid()&&H&&moment(H).isValid()&&(w=moment(H),w>Y&&(Y=w),$(i).data("DateTimePicker").setMinDate(w)),H=t.$eval(a.maxDate),!T.isValid()&&H&&moment(H).isValid()&&(T=moment(H),Y>T&&(Y=T),$(i).data("DateTimePicker").setMaxDate(T));var e=0===T.diff(n.$viewValue,"days"),m=0===w.diff(n.$viewValue,"days");s(g&&e&&M,g&&m&&k),t.selectedTime=f();var o=n.$viewValue;if(o){var r=d();$(i).data("DateTimePicker").setDate(r)}})}),g&&(c(),t.selectedTimeChanged=function(){n.$setViewValue(m())})}}}}]);