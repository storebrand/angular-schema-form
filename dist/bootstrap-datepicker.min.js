angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,a){var i=function(t,i,n){if("string"===i.type&&"date-format"===i.format){var o=e.stdFormObj(t,i,n);return o.key=n.path,o.type="datepicker",n.lookup[a.stringify(n.path)]=o,o}};e.defaults.string.unshift(i)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";return{restrict:"A",require:"ngModel",priority:0,link:function(t,a,i,n){function o(){return m(k.val(),t.selectedTime)}function m(e,t){return moment(e,"DD.MM.YY").format("YYYY-MM-DD")+(b?"T"+moment(t,"HH:mm").format("HH:mm:ss"):"")}function r(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function u(e){if(!e)return null;var t=30,a=e.minute()%t;return e.subtract("minutes",a).format("HH:mm")}function d(){return n.$viewValue?moment(n.$viewValue).format("HH:mm"):f(H)}function f(e){var t=e&&g&&0===g.diff(e,"days"),a=e&&Y&&0===Y.diff(e,"days");return i.defaultTime||(t&&p>T?T:a&&w>p?w:p)}function c(){for(var e=0;v>e;e++)[":00",":30"].forEach(function(a){t.timeOptions.push({value:r(e+a),isDisabled:!1})});a.addClass("has-timepicker")}function s(e,a){var i=t.selectedTime;i&&t.timeOptions.forEach(function(t){t.isDisabled=e&&t.value>e||a&&t.value<a});var o=!e||e>=i,m=!a||i>=a;t.selectedTime=o&&m?d():f(n.$viewValue)}function l(){e(function(){if(!Y.isValid()){var e=t.$eval(i.minDate);e&&moment(e).isValid()&&(Y=moment(e),Y>H&&(H=Y),$(a).data("DateTimePicker").setMinDate(Y))}if(!g.isValid()){var n=t.$eval(i.maxDate);n&&moment(n).isValid()&&(g=moment(n),H>g&&(H=g),$(a).data("DateTimePicker").setMaxDate(g))}})}function D(){e(function(){var e=moment(n.$viewValue,"YYYY-MM-DD"),t=0===g.diff(e,"days"),i=0===Y.diff(e,"days");if(b&&s(t&&T,i&&w),e.isValid()){var o=e.format("DD.MM.YY");$(a).data("DateTimePicker").setDate(o)}})}if(a.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var v=24,p="12:00",h=moment(),y=moment().add(1,"day"),V={today:h,tomorrow:y},k=$(a).find("input"),M=t.$eval(i.monthlyDifference),Y=V[i.minDate]||moment(i.minDate)||t.$eval(i.disableUntilToday)&&h.toDate(),g=V[i.maxDate]||moment(i.maxDate)||M&&moment(h).add(M,"Month").toDate(),w=u(Y),T=u(g),b=Boolean(i.showTime),H=i.defaultDate;t.timeOptions=[],$(a).datetimepicker({pickTime:!1,language:"nb",format:"DD.MM.YY",useCurrent:!1,minDate:Y,maxDate:g}).on("dp.change",function(){t.$apply(function(){n.$setViewValue(o())})}).on("dp.error",function(){t.$apply(function(){n.$setViewValue(void 0)})}),t.$watch("model",l),t.$watch(t.keyModelName,D),b?(c(),t.selectedTimeChanged=function(){n.$modelValue&&n.$setViewValue(o())}):a.addClass("no-timepicker")}}}}]);