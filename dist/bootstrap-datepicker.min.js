angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,a){var i=function(t,i,n){if("string"===i.type&&"date-format"===i.format){var o=e.stdFormObj(t,i,n);return o.key=n.path,o.type="datepicker",n.lookup[a.stringify(n.path)]=o,o}};e.defaults.string.unshift(i)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout",function(e){"use strict";return{restrict:"A",require:"ngModel",priority:0,link:function(t,a,i,n){function o(){var e=y.val();return m(e,t.selectedTime)}function m(e,t){return moment(e,"DD.MM.YY").format("YYYY-MM-DD")+(M?"T"+moment(t,"HH:mm").format("HH:mm:ss"):"")}function r(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function u(e){if(!e)return null;var t=30,a=e.minute()%t;return e.subtract("minutes",a).format("HH:mm")}function f(){return n.$viewValue?moment(n.$viewValue).format("HH:mm"):b}function d(){return n.$viewValue&&moment(n.$viewValue).format("DD.MM.YY")}function l(){for(var e=0;s>e;e++)[":00",":30"].forEach(function(a){t.timeOptions.push({value:r(e+a),isDisabled:!1})})}function c(e,a){t.timeOptions.forEach(function(t){t.isDisabled=e&&t.value>e||a&&t.value<a})}if(a.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var s=24,v="12:00",D=moment(),p=moment().add(1,"day"),h={today:D,tomorrow:p},y=$(a).find("input"),V=t.$eval(i.monthlyDifference),g=h[i.minDate]||moment(i.minDate)||t.$eval(i.disableUntilToday)&&D.toDate(),w=h[i.maxDate]||moment(i.maxDate)||V&&moment(D).add(V,"Month").toDate(),T=u(g),k=u(w),M=Boolean(i.showTime),Y=i.defaultDate,b=i.defaultTime||(w&&0===w.diff(moment(Y))&&v>k?k:g&&0===g.diff(moment(Y))&&T>v?T:v);t.timeOptions=[];{i.events||{}}$(a).datetimepicker({pickTime:!1,language:"nn",format:"DD.MM.YY",useCurrent:!1,minDate:g,maxDate:w}).on("dp.change",function(){t.$apply(function(){var e=o();if(M&&w){var a=0===w.diff(e,"days"),i=0===g.diff(e,"days");(a&&t.selectedTime>k||i&&t.selectedTime<T)&&(t.selectedTime=b,e=o())}n.$setViewValue(e)})}).on("dp.error",function(){t.$apply(function(){n.$setViewValue(void 0)})});var H;t.$watch(t.keyModelName,function(){e(function(){H=t.$eval(i.minDate),console.log("minDate",H),!g.isValid()&&H&&moment(H).isValid()&&(g=moment(H),g>Y&&(Y=g),$(a).data("DateTimePicker").setMinDate(g)),H=t.$eval(i.maxDate),console.log("maxDate",H),!w.isValid()&&H&&moment(H).isValid()&&(w=moment(H),Y>w&&(Y=w),$(a).data("DateTimePicker").setMaxDate(w));var e=0===w.diff(n.$viewValue,"days"),o=0===g.diff(n.$viewValue,"days");c(M&&e&&k,M&&o&&T),t.selectedTime=f();var m=n.$viewValue;if(m){var r=d();$(a).data("DateTimePicker").setDate(r)}})}),M&&(l(),t.selectedTimeChanged=function(){n.$setViewValue(o())})}}}}]);