angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,a){var n=function(t,n,i){if("string"===n.type&&"date-format"===n.format){var m=e.stdFormObj(t,n,i);return m.key=i.path,m.type="datepicker",i.lookup[a.stringify(i.path)]=m,m}};e.defaults.string.unshift(n)}]),angular.module("schemaForm").directive("stbDatepicker",["$timeout","$rootScope",function(e,t){"use strict";var a="YYYY-MM-DDTHH:mm:ss",n="YYYY-MM-DD",i="HH:mm",m="HH:mm:ss";return{restrict:"A",require:"ngModel",priority:0,link:function(o,r,u,l){function c(){e(function(){var e={min:C.isValid()?null:o.$eval(u.minDate),max:O.isValid()?null:o.$eval(u.maxDate)};w(e)})}function d(){e(function(){o.selectedTime=V(),g(l.$viewValue),M(l.$viewValue)})}function f(){return s(H.val(),o.selectedTime)}function s(e,t){return moment(e,"DD.MM.YY").format(n)+(q?"T"+moment(t,i).format(m):"")}function v(e){return(e||"").replace(/^(\d{1}):/,"0$1:")}function D(e){if(!e)return null;var t=30,a=e.minute()%t;return e.subtract("minutes",a).format(i)}function p(e,t){return e&&t&&moment(e).isValid()&&moment(e).isValid()&&moment(e).format(n)===moment(t).format(n)}function V(){return l.$viewValue?moment(l.$viewValue).format(i):h(A)}function h(e){var t=p(O,e),a=p(C,e);return u.defaultTime||(t&&y>j?j:a&&E>y?E:y)}function k(){for(var e=0;Y>e;e++)[":00",":30"].forEach(function(t){o.timeOptions.push({value:v(e+t),isDisabled:!1})});r.addClass("has-timepicker")}function w(e){e.min&&moment(e.min).isValid()&&(C=moment(e.min),E=moment(C,a).format(i),C>A&&(A=C),$(r).data("DateTimePicker").setMinDate(C)),e.max&&moment(e.max).isValid()&&(O=moment(e.max),j=O.format(i),A>O&&(A=O),$(r).data("DateTimePicker").setMaxDate(O))}function M(e,n){var i=moment(e,a);if(i.isValid()){var m=i.format("DD.MM.YY");$(r).data("DateTimePicker").setDate(m),n||t.$broadcast("datetimepicker.changed",{name:B,value:i})}}function T(e,t){o.timeOptions.forEach(function(a){a.isDisabled=e&&a.value>e||t&&a.value<t})}function g(e){var t=moment(e,a);if(q){var n=p(O,t)&&j,i=p(C,t)&&E,m=!n||o.selectedTime<=n,r=!i||o.selectedTime>=i;m&&r?T(n,i):l.$setViewValue(s(H.val(),h(t)))}}if(r.unbind("input").unbind("keydown").unbind("change"),$.fn.datetimepicker){var Y=24,y="12:00",b=moment(),x=moment().add(1,"day"),P={today:b,tomorrow:x},H=$(r).find("input"),F=o.$eval(u.monthlyDifference),C=P[u.minDate]||moment(u.minDate)||o.$eval(u.disableUntilToday)&&b.toDate(),O=P[u.maxDate]||moment(u.maxDate)||F&&moment(b).add(F,"Month").toDate(),E=D(C),j=D(O),q=Boolean(u.showTime),A=u.defaultDate,B=_.last(o.$eval(u.name));o.timeOptions=[],$(r).datetimepicker({pickTime:!1,language:"nb",format:"DD.MM.YY",useCurrent:!1,minDate:C,maxDate:O}).on("dp.change",function(){o.$apply(function(){l.$setViewValue(f())})}).on("dp.error",function(){o.$apply(function(){l.$setViewValue(void 0)})}),o.$watch("model",c),o.$watch(o.keyModelName,d),o.$on("datetimepicker.changed",function(e,t){if(t.name!==B){var n={min:t.name===u.minDate&&t.value,max:t.name===u.maxDate&&t.value};if(w(n),o.selectedTime){var i=C.isValid()&&C.format(a)>l.$viewValue?C.format(a):O.isValid()&&O.format(a)<l.$viewValue?O.format(a):l.$viewValue;g(i),M(i,!0)}}}),q?(k(),o.selectedTimeChanged=function(){l.$modelValue&&l.$setViewValue(f())}):r.addClass("no-timepicker")}}}}]);